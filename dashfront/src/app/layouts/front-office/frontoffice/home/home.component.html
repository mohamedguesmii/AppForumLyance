<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Espace Candidature</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    
    .page-background {
      min-height: 100vh;
      background: linear-gradient(135deg, rgba(246, 246, 245, 0.8), rgb(255, 255, 255));
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.25);
      color: #000000;
      padding-top: 1rem;
      padding-bottom: 3rem;
    }

    .card,
    .form-control,
    .form-select,
    .input-group,
    .btn {
      border-radius: 0.4rem;
    }

    .hover-shadow:hover {
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    
    .no-radius {
      border-radius: 0 !important;
    }

    .page-background {
      position: relative;
      min-height: 100vh;
      background-image: url('assets/img/pxx.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-blend-mode: overlay;
      background-color: rgba(22, 20, 20, 0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.25);
      color: #000000;
      padding-top: 1rem;
      padding-bottom: 3rem;
      z-index: 0;
    }
  </style>
</head>
<body>

  <button
    class="btn btn-warning fw-bold px-4"
    (click)="goBack()"
    style="position: fixed; top: 20px; left: 20px; z-index: 1050;"
  >
    Retour
  </button>

  <div class="page-background">
    <section class="pt-5 pb-5">
      <div class="container">

        <!-- Titre principal -->
        <div class="text-center mb-4">
          <h2 class="fw-bold" style="font-size: 2.5rem; color: #a0999f;">
            👋 Bienvenue sur votre espace Candidature
          </h2>

          <p class="mt-3 fs-8" style="color: #a0999f;">
            Consultez nos offres et déposez votre CV dès maintenant. 💼
          </p>
        </div>

        <!-- Formulaire de recherche -->
        <div class="mb-5 text-center">
          <form class="d-inline-block w-50" (ngSubmit)="applyFilter()" novalidate>
            <input
              type="text"
              class="form-control shadow-sm no-radius"
              placeholder="🔍 Rechercher par titre ou lieu..."
              [(ngModel)]="searchTerm"
              name="searchTerm"
              autocomplete="off"
              (input)="onSearchChange()"
              [ngModelOptions]="{standalone: true}"
            />
          </form>
        </div>

        <!-- Titre offres disponibles -->
        <h4 class="fw-bold mb-4 text-center fs-4" style="color: #999599;">
          📝 <span class="gradient-title">Offres Disponibles</span>
        </h4>
        <hr class="mb-4" />

        <!-- Offres -->
        <div class="row gy-4">

          <!-- Offres d'emploi -->
          <div class="col-md-6">
            <h5 class="mb-3 fw-bold fs-6" style="color: #cb06b4;">🧑‍💼 Offres d'emploi</h5>
            <ng-container *ngIf="offresEmploi.length > 0; else noOffres">
              <div *ngFor="let offre of offresEmploi" class="card mb-3 border-0 shadow-sm">
                <hr class="mb-4" />
                <div class="card-body">
                  <h6 class="card-title fw-bold fs-6">💼 {{ offre.titre }}</h6>
                  <p *ngIf="getEvenementTitre(offre.evenementId)" class="card-text mb-1 fst-italic text-primary">
                    📅 Événement associé : {{ getEvenementTitre(offre.evenementId) }}
                  </p>
                  <p class="card-text mb-1"><span class="text-secondary fw-semibold">🏢 Entreprise :</span> {{ offre.description }}</p>
                  <p class="card-text mb-1"><span class="text-secondary fw-semibold">⏳ Durée :</span> {{ offre.duree }}</p>
                  <p class="card-text">
                    <small class="text-success">{{ offre.statut }} • Publié le {{ offre.datePublication | date:'dd/MM/yyyy' }}</small>
                  </p>

                  <!-- Bouton ou badge postulation -->
                  <button 
                    *ngIf="!offresPostulees.includes(offre.id)" 
                    class="btn btn-outline-primary btn-sm" 
                    (click)="postuler(offre.id)">
                    📩 Postuler
                  </button>
                  <span 
                    *ngIf="offresPostulees.includes(offre.id)" 
                    class="badge bg-success p-2 fs-6">
                    ✅ Déjà postulé
                  </span>
                </div>
              </div>

              <!-- Pagination Emploi -->
              <nav aria-label="Pagination offres emploi">
                <ul class="pagination justify-content-center align-items-center gap-2" style="margin-top: 2rem;">
                  <li class="page-item" [class.disabled]="emploiPage === 1">
                    <button 
                      class="btn btn-sm px-3 py-2 fw-bold text-white" 
                      [style.background]="emploiPage === 1 ? '#cccccc' : 'linear-gradient(90deg, #222222, #555555)'"
                      (click)="emploiPreviousPage()" 
                      [disabled]="emploiPage === 1">
                      🡨
                    </button>
                  </li>
                  <li class="page-item disabled">
                    <span 
                      class="btn btn-sm fw-semibold text-dark bg-light border" 
                      style="pointer-events: none;">
                      Page {{ emploiPage }} sur {{ emploiTotalPages }}
                    </span>
                  </li>
                  <li class="page-item" [class.disabled]="emploiPage === emploiTotalPages">
                    <button 
                      class="btn btn-sm px-3 py-2 fw-bold text-white" 
                      [style.background]="emploiPage === emploiTotalPages ? '#cccccc' : 'linear-gradient(90deg, #222222, #555555)'"
                      (click)="emploiNextPage()" 
                      [disabled]="emploiPage === emploiTotalPages">
                      🡪
                    </button>
                  </li>
                </ul>
              </nav>

            </ng-container>
          </div>

          <!-- Offres de stage -->
          <div class="col-md-6">
            <h5 class="mb-3 fw-bold fs-6" style="color: #ccb801;">🎓 Offres de stage</h5>
            <ng-container *ngIf="offresStage.length > 0; else noOffres">
              <div *ngFor="let offre of offresStage" class="card mb-3 border-0 shadow-sm">
                <hr class="mb-4" />
                <div class="card-body">
                  <h6 class="card-title fw-bold fs-6">💼 {{ offre.titre }}</h6>
                  <p *ngIf="getEvenementTitre(offre.evenementId)" class="card-text mb-1 fst-italic text-primary">
                    📅 Événement associé : {{ getEvenementTitre(offre.evenementId) }}
                  </p>
                  <p class="card-text mb-1"><span class="text-secondary fw-semibold">🏢 Entreprise :</span> {{ offre.description }}</p>
                  <p class="card-text mb-1"><span class="text-secondary fw-semibold">⏳ Durée :</span> {{ offre.duree }}</p>
                  <p class="card-text">
                    <small class="text-success">{{ offre.statut }} • Publié le {{ offre.datePublication | date:'dd/MM/yyyy' }}</small>
                  </p>

                  <!-- Bouton ou badge postulation -->
                  <button 
                    *ngIf="!offresPostulees.includes(offre.id)" 
                    class="btn btn-outline-warning btn-sm" 
                    (click)="postuler(offre.id)">
                    📩 Postuler
                  </button>
                  <span 
                    *ngIf="offresPostulees.includes(offre.id)" 
                    class="badge bg-success p-2 fs-6">
                    ✅ Déjà postulé
                  </span>
                </div>
              </div>

              <!-- Pagination Stage -->
              <nav aria-label="Pagination offres stage">
                <ul class="pagination justify-content-center align-items-center gap-2" style="margin-top: 2rem;">
                  <li class="page-item" [class.disabled]="stagePage === 1">
                    <button 
                      class="btn btn-sm px-3 py-2 fw-bold text-white" 
                      [style.background]="stagePage === 1 ? '#cccccc' : 'linear-gradient(90deg, #222222, #555555)'"
                      (click)="stagePreviousPage()" 
                      [disabled]="stagePage === 1">
                      🡨
                    </button>
                  </li>
                  <li class="page-item disabled">
                    <span 
                      class="btn btn-sm fw-semibold text-dark bg-light border" 
                      style="pointer-events: none;">
                      Page {{ stagePage }} sur {{ stageTotalPages }}
                    </span>
                  </li>
                  <li class="page-item" [class.disabled]="stagePage === stageTotalPages">
                    <button 
                      class="btn btn-sm px-3 py-2 fw-bold text-white" 
                      [style.background]="stagePage === stageTotalPages ? '#cccccc' : 'linear-gradient(90deg, #222222, #555555)'"
                      (click)="stageNextPage()" 
                      [disabled]="stagePage === stageTotalPages">
                      🡪
                    </button>
                  </li>
                </ul>
              </nav>

            </ng-container>
          </div>
        </div>

        <!-- Message aucun offre -->
        <ng-template #noOffres>
          <p class="text-center fst-italic text-muted">😞 Aucune offre disponible pour le moment.</p>
        </ng-template>

        <!-- Catégories -->
        <div class="row mt-5">
          <div class="col-12 mb-4">
            <span class="text-uppercase fw-bold" style="font-weight: 900; font-size: 1.5rem; display: inline-block; vertical-align: middle;">
              🗂️
            </span>
            <span class="gradient-title" style="color: white;">
              Catégories disponibles
            </span>
          </div>

          <div class="col-md-3 mb-4">
            <button 
              type="button" 
              class="card align-items-center py-4 hover-shadow bg-white border border-dark text-center w-100"
              style="border-radius: 0.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
              <span class="icon-circle icon-circle-lg bg-light text-primary fs-3">📊</span>
              <span class="mt-3 fw-semibold text-dark">Statistiques</span>
            </button>
          </div>

          <div class="col-md-3 mb-4">
            <button 
              type="button" 
              class="card align-items-center py-4 hover-shadow bg-white border border-dark text-center w-100" 
              (click)="goToChat()" 
              style="border-radius: 0.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
              <span class="icon-circle icon-circle-lg bg-light text-primary fs-3">💬</span>
              <span class="mt-3 fw-semibold text-dark">Conversations</span>
            </button>
          </div>

          <div class="col-md-3 mb-4">
            <button 
              type="button" 
              class="card align-items-center py-4 hover-shadow bg-white border border-dark text-center w-100" 
              (click)="goToEmail()" 
              style="border-radius: 0.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
              <span class="icon-circle icon-circle-lg bg-light text-primary fs-3">✉️</span>
              <span class="mt-3 fw-semibold text-dark">Email</span>
            </button>
          </div>

          <div class="col-md-3 mb-4">
            <button 
              type="button" 
              class="card align-items-center py-4 hover-shadow bg-white border border-dark text-center w-100" 
              (click)="goToHistorical()" 
              style="border-radius: 0.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
              <span class="icon-circle icon-circle-lg bg-light text-primary fs-3">📁</span>
              <span class="mt-3 fw-semibold text-dark">Historique</span>
            </button>
          </div>

        </div>

      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
