<div class="container py-5">
  <div class="card shadow-lg p-4">
    <h2 class="mb-4 text-center text-primary fw-bold">Recherche RAG</h2>

    <!-- Champ de recherche -->
    <div class="input-group mb-4">
      <input
        #searchInput
        type="text"
        class="form-control"
        [(ngModel)]="query"
        placeholder="Rechercher un événement, une offre, une question FAQ..."
        (keyup.enter)="onSearch()"
        [disabled]="loading"
        aria-label="Recherche"
        autofocus
      />
      <button
        class="btn btn-primary"
        (click)="onSearch()"
        [disabled]="loading || !query.trim()"
        aria-label="Bouton Rechercher"
      >
        <span *ngIf="!loading">Rechercher</span>
        <span *ngIf="loading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      </button>
    </div>

    <!-- Message d'erreur -->
    <div *ngIf="errorMessage" class="alert alert-danger text-center" aria-live="assertive" role="alert">
      {{ errorMessage }}
    </div>

    <!-- Résultats -->
    <div *ngIf="results.length > 0" class="mt-4" aria-live="polite" role="region" aria-atomic="true" style="max-height: 60vh; overflow-y: auto;">
      <h4 class="text-success mb-3">Résultats ({{ results.length }}) :</h4>

      <div *ngFor="let doc of results" class="card mb-4 shadow-sm border-start border-4 border-primary">
        <div class="card-body">
          <small class="text-muted fst-italic d-block mb-2">[{{ doc.type | titlecase }}] - ID {{ doc.id }}</small>

          <!-- Événement -->
          <ng-container *ngIf="doc.type === 'evenement'">
            <ng-container *ngIf="parseEvenement(doc.enrichedContent) as evt">
              <h5 class="card-title text-primary fw-bold mb-3">
                {{ evt.titre || 'Titre non disponible' }}
              </h5>
              <p class="mb-1"><strong>Adresse :</strong> {{ evt.adresse || 'Non renseignée' }}</p>
              <p class="mb-1">
                <strong>Dates :</strong>
                <span *ngIf="evt.dateDebut && evt.dateFin; else dateIndisponible">
                  du {{ evt.dateDebut }} au {{ evt.dateFin }}
                </span>
                <ng-template #dateIndisponible>Dates non précisées</ng-template>
              </p>
              <p class="mb-2"><strong>Description :</strong> {{ evt.description || 'Aucune description' }}</p>
            </ng-container>
          </ng-container>

          <!-- Offre -->
          <ng-container *ngIf="doc.type === 'offre'">
            <h5 class="card-title text-success fw-bold mb-3">Offre</h5>
            <p>{{ doc.enrichedContent }}</p>
          </ng-container>

          <!-- Autres types -->
          <ng-container *ngIf="doc.type !== 'evenement' && doc.type !== 'offre'">
            <h5 class="card-title text-secondary fw-bold mb-3">{{ doc.type | titlecase }}</h5>
            <p>{{ doc.content }}</p>
          </ng-container>

          <small class="text-muted fst-italic d-block mt-3">
            Similarité : {{ doc.distance | number:'1.3-3' }}
          </small>
        </div>
      </div>
    </div>

    <!-- Aucun résultat -->
    <div *ngIf="!loading && results.length === 0 && query.trim()" class="alert alert-warning text-center" aria-live="polite" role="alert">
      Aucun résultat trouvé pour "<strong>{{ query }}</strong>"
    </div>
  </div>
</div>
