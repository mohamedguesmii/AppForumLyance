<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
  }

  .main-container {
    display: flex;
    height: 100vh;
    background-image: url('assets/frontoffice/img/jj.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  .content-container {
    flex: 1;
    overflow-y: auto;
    padding: 40px 20px;
    background-color: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(5px);
    color: white;
  }

  .gradient-title {
    font-size: 1.5rem;
    font-weight: bold;
    text-align: left;
    background: linear-gradient(90deg, black, rgb(2, 78, 77));
    color: rgb(32, 213, 201);
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 0;
  }

  table.table {
    max-width: 1300px;
    width: 100%;
    font-size: 0.85rem;
  }

  thead th {
    background-color: #222;
    color: #fff;
  }

  tbody td {
    background-color: transparent !important;
    color: inherit !important;
    vertical-align: middle;
  }

  .event-image {
    max-width: 100px;
    height: auto;
    object-fit: contain;
    border-radius: 4px;
  }

  .star-rating span.full::before {
    content: '★';
    color: gold;
  }

  .star-rating span.empty::before {
    content: '☆';
    color: lightgray;
  }

  .star-rating input[type='range'] {
    width: 100px;
  }

  /* Modal styles */
  .modal {
    display: block;
    z-index: 1050;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-dialog {
    position: relative;
    margin: auto;
    top: 10%;
    max-width: 600px;
  }

  .modal-content {
    background-color: #1e1e1e;
    color: white;
    border: 1px solid #555;
    border-radius: 10px;
    padding: 20px;
  }

  .modal-header,
  .modal-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header {
    border-bottom: none;
  }

  .btn-close-white {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: white;
    cursor: pointer;
  }

  .modal-body input,
  .modal-body textarea {
    background-color: #2c2c2c;
    color: white;
    border: 1px solid #666;
  }

  .modal-body input:focus,
  .modal-body textarea:focus {
    border-color: #0d6efd;
    outline: none;
    box-shadow: 0 0 5px #0d6efd;
  }
</style>

<div class="main-container">
  <div class="content-container">

    <!-- Notification -->
    <div *ngIf="notificationMessage" class="alert alert-success alert-dismissible fade show w-100" role="alert" style="max-width: 700px;">
      {{ notificationMessage }}
      <button type="button" class="close" (click)="notificationMessage = ''" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <!-- Barre supérieure -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="gradient-title">Liste des Événements</h2>
      <button type="button" class="btn btn-sm btn-success" (click)="openAddModal()">Ajouter Événement</button>
    </div>

    <!-- Barre de recherche -->
    <div class="form-group mb-3">
      <input
        type="text"
        class="form-control"
        placeholder="Rechercher par titre..."
        [formControl]="searchControl"
      />
    </div>

    <!-- Bouton suppression multiple -->
    <div class="mb-2" *ngIf="selectedEvenements.length > 0">
      <button class="btn btn-danger btn-sm" (click)="deleteSelected()">
        Supprimer la sélection ({{ selectedEvenements.length }})
      </button>
    </div>

    <!-- Tableau -->
    <div class="table-responsive" style="max-width: 1300px; width: 100%; margin-top: 15px;">
      <table class="table table-sm table-bordered table-hover text-center table-dark align-middle">
        <thead>
          <tr>
            <th><input type="checkbox" (change)="toggleSelectAll($event)" /></th>
            <th>Nom événement</th>
            <th>Description</th>
            <th>Capacité</th>
            <th>Date début</th>
            <th>Date fin</th>
            <th>Adresse</th>
            <th>Image</th>
            <th>Rating</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let evenement of paginatedEvenements">
            <td>
              <input type="checkbox"
                     [checked]="selectedEvenements.includes(evenement.idevent)"
                     (change)="toggleSelection(evenement.idevent)" />
            </td>
            <td>{{ evenement.title }}</td>
            <td>{{ evenement.description }}</td>
            <td>{{ evenement.capacity }}</td>
            <td>{{ evenement.datedebut | date }}</td>
            <td>{{ evenement.datefin | date }}</td>
            <td>{{ evenement.adresse }}</td>
            <td>
              <img *ngIf="evenement.imageUrl" [src]="evenement.imageUrl" class="event-image" alt="Image événement" />
              <span *ngIf="!evenement.imageUrl">Pas d'image</span>
            </td>
            <td>
              <div class="star-rating" aria-label="Note de l'événement">
                <span
                  *ngFor="let star of [1, 2, 3, 4, 5]"
                  (click)="updateRating(evenement.idevent, star)"
                  [class.full]="evenement.starRating >= star"
                  [class.empty]="evenement.starRating < star"
                  title="{{ star }} étoile{{ star > 1 ? 's' : '' }}"
                  style="cursor: pointer;"
                ></span>
              </div>
            </td>
            <td>
              <button class="btn btn-info btn-sm me-1" (click)="selectEvenement(evenement)">
                <i class="fa fa-pencil"></i>
              </button>
              <button class="btn btn-danger btn-sm me-1" (click)="deleteEvenement(evenement.idevent)">
                <i class="fa fa-trash"></i>
              </button>
              <button class="btn btn-primary btn-sm" (click)="updateEvenement()">
                <i class="fa fa-refresh"></i>
              </button>

<button class="btn btn-warning btn-sm" (click)="actualiserEvenementsExistants()">
<i class="fa fa-sync-alt"></i>  <!-- Si ta version supporte fa-sync-alt -->
</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <nav *ngIf="totalPages > 1" class="d-flex justify-content-center">
        <ul class="pagination pagination-sm">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" href="#" (click)="goToPage(currentPage - 1); $event.preventDefault()">«</a>
          </li>
          <li
            class="page-item mx-1"
            *ngFor="let page of [].constructor(totalPages); let i = index"
            [class.active]="currentPage === i + 1"
          >
            <a class="page-link" href="#" (click)="goToPage(i + 1); $event.preventDefault()">{{ i + 1 }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" href="#" (click)="goToPage(currentPage + 1); $event.preventDefault()">»</a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Modal (inchangé) -->
    <div *ngIf="isAddModalOpen">
      <div class="modal" (click)="closeAddModal()">
        <div class="modal-dialog" (click)="$event.stopPropagation()">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">{{ isEditing ? 'Modifier Événement' : 'Ajouter Événement' }}</h5>
              <button type="button" class="btn-close-white" (click)="closeAddModal()" aria-label="Close">&times;</button>
            </div>

            <form [formGroup]="evenementForm" (ngSubmit)="isEditing ? updateEvenement() : addEvenement()" class="form">
              <div class="modal-body">
                <div class="mb-3">
                  <label for="title">Nom de l'événement</label>
                  <input id="title" type="text" formControlName="title" class="form-control" />
                </div>
                <div class="mb-3">
                  <label for="description">Description</label>
                  <textarea id="description" formControlName="description" class="form-control"></textarea>
                </div>
                <div class="mb-3">
                  <label for="capacity">Capacité</label>
                  <input id="capacity" type="number" formControlName="capacity" class="form-control" />
                </div>
                <div class="mb-3">
                  <label for="datedebut">Date de début</label>
                  <input id="datedebut" type="date" formControlName="datedebut" class="form-control" />
                </div>
                <div class="mb-3">
                  <label for="datefin">Date de fin</label>
                  <input id="datefin" type="date" formControlName="datefin" class="form-control" />
                </div>
                <div class="mb-3">
                  <label for="adresse">Adresse</label>
                  <input id="adresse" type="text" formControlName="adresse" class="form-control" />
                </div>
                <div class="mb-3">
                  <label for="image">Image de l'événement</label>
                  <input id="image" type="file" (change)="onFileSelected($event)" class="form-control" />
                  <div *ngIf="imagePreview" style="margin-top:10px;">
                    <img [src]="imagePreview" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 5px;" />
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary" [disabled]="evenementForm.invalid">
                  {{ isEditing ? 'Enregistrer' : 'Ajouter' }}
                </button>
                <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Fermer</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
