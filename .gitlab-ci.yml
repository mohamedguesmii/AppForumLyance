stages:
  - build

# =========================
# Build Backend Spring Boot
# =========================
build-backend:
  stage: build
  image: maven:3.8.8-openjdk-17
  script:
    - cd EvenementCrud
    - ./mvnw clean package -DskipTests
    - cd ..
  artifacts:
    paths:
      - EvenementCrud/target/*.jar

# =========================
# Build Frontend Angular
# =========================
build-frontend:
  stage: build
  image: node:18
  script:
    - cd dashfront
    - npm install
    - npm run build --prod
    - cd ..
  artifacts:
    paths:
      - dashfront/dist/

# =========================
# Build n8n workflow
# =========================
build-n8n:
  stage: build
  image: node:18
  script:
    - cd n8n
    - npm install
    - npm run build || echo "n8n build skipped if no build script"
    - cd ..
  artifacts:
    paths:
      - n8n/dist/

# =========================
# Build RAG (AI service)
# =========================
build-rag:
  stage: build
  image: maven:3.8.8-openjdk-17
  script:
    - cd RAG
    - ./mvnw clean package -DskipTests || echo "RAG build skipped if not Maven"
    - cd ..
  artifacts:
    paths:
      - RAG/target/*.jar

# =========================
# Build scraping service
# =========================
build-scraping:
  stage: build
  image: node:18
  script:
    - cd scraping
    - npm install
    - npm run build || echo "Scraping build skipped if no build script"
    - cd ..
  artifacts:
    paths:
      - scraping/dist/
